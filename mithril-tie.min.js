/**
 mithril-tie - browser input helper for mithril
 @version v0.1.0
 @link https://github.com/7korobi/mithril-tie
 @license 
**/


(function(){module.exports={}}).call(this),function(){var a,b,c;a=require("memory-record"),c=function(a,b,c){return function(d){return arguments.length?a[b]=c(d):a[b]}},b=function(){function b(){this.prop={}}return b.browser={},b.types={url:["protocol","host","pathname","search","hash","href"],store:["session","local","cookie"]},b.build_input=function(a,b,d,e){return a.deploy(c,d,e),a},b.build_url=function(d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r;for(q=new b,n=b.types.url,j=0,l=n.length;j<l;j++)if(r=n[j],i=d[r])for(g in i)h=i[g],f.conf[g]||f.type[r].push(f.conf[g]=new f(g,r,h));for(o=a.Query.stores.list,k=0,m=o.length;k<m;k++)p=o[k],q.deploy(c,e,p);return q},b.build_store=function(c,d,e){var f,g,h,i,j;for(null==c&&(c=[]),j=new b,h=a.Query.stores.where({_id:c}).list,f=0,g=h.length;f<g;f++)i=h[f],j.deploy(d,e,i);return j},b.prototype.deploy=function(b,c,d){var e,f,g,h,i,j;switch(e=d._id,f=d.current,h=d.type,null==f&&(f=null),i=a.unpack[h],g=a.pack[h],this.prop[e]=b(c,e,i,g),j=this.prop[e]()){case void 0:case null:case"":return this.prop[e](j=f)}},b.prototype.copyBy=function(a){var b,c,d,e;d=this.prop,e=[];for(b in d)c=d[b],e.push(c(a.prop[b]()));return e},b.prototype.copyTo=function(a){var b,c,d,e;d=this.prop,e=[];for(b in d)c=d[b],e.push(a.prop[b](c()));return e},b}(),b.params={},module.exports.Tie=b}.call(this),function(){var a,b,c,d,e,f,g,h=[].slice;b=require("memory-record"),f=require("mithril"),d=require("lodash"),c=module.exports.Tie,g=function(){var a;return a=1<=arguments.length?h.call(arguments,0):[],d.assignIn.apply(d,a)},e=function(a,b){var c,e;return c=function(b,c,d){if(a.dom=b,!c)return null!=b.checkValidity?b.checkValidity:b.checkValidity=function(){var b,c,d,e;for(e=a._inputs,b=0,d=e.length;b<d;b++)if(c=e[b],c.dom&&!c.dom.checkValidity())return!1;return!0}},e=d.assignIn(b,{config:c,disabled:a.disabled,onsubmit:function(b){return a.do_submit(),!1}})},a=function(){function a(a){var d,e,f,g;for(this.params=a.params,f=a.ids,this._cancel(),this._draws=[function(a){return function(){var b,c,d,e,f;for(e=a._inputs,f=[],b=0,d=e.length;b<d;b++)c=e[b],f.push(c.do_draw());return f}}(this)],this._inputs=[],this._infos={},this.input={},this.tie=new c,d=0,g=f.length;d<g;d++)e=f[d],this.bundle(b.Query.inputs.find(e))}return a.util={},a.type={},a.prototype.timeout=1e3,a.prototype._debounce=function(){return this.timer=!0,new Promise(function(a){return function(b,c){return a.timer=setTimeout(function(){return c("reset "+a.timeout+"ms ")},a.timeout)}}(this))},a.prototype._cancel=function(){return this.disabled=!1,this.disable(!1),this.timer=null},a.prototype.action=function(){},a.prototype.disable=function(a,b){},a.prototype.focus=function(a,b,c){},a.prototype.stay=function(a,b){},a.prototype.change=function(a,b,c){},a.prototype.select=function(a,b,c){},a.prototype.do_change=function(a,b){var c,d;return b=a.__val(b),a.do_change(b),this.disabled=!!this.timer,c=a._id,d=this.params[c],d===b?this.stay(c,b):(this.params[c]=b,this.change(c,b,d))},a.prototype.do_fail=function(a,b){return b=a.__val(b),a.do_fail(b)},a.prototype.do_blur=function(a,b){var c;return a.do_blur(b),c=a._id,this.focus(c,!1)},a.prototype.do_focus=function(a,b){var c;return a.do_focus(b),c=a._id,this.focus(c,!0,this.focus_id,this.focused),this.focus_id=c,this.focused=a},a.prototype.do_move=function(a,b){var c;return a.do_move(b),c=a._id},a.prototype.do_select=function(a,b){var c,d,e,f;return f=getSelection(),c=f.anchorOffset,d=f.focusOffset,e=[c,d].sort(),this.select(a,f.toString(),e)},a.prototype.do_submit=function(){var a,b,c;if(!this.timer&&this.dom.checkValidity())return b=this._debounce(),a=c=this.action(),null==this.action.then&&(a=new Promise(function(a){return a(c)})),this.disabled=!0,this.disable(!0),f.redraw(),Promise.race([b,a]).then(function(a){return function(){return clearTimeout(a.timer)}}(this)).catch(function(a){return function(b){return a.message=b,console.log(a.message)}}(this)).then(function(a){return function(){return a._cancel(),f.redraw()}}(this))},a.prototype.cancel=function(){return clearTimeout(this.timer),this._cancel()},a.prototype.submit=function(){var a,b,c;return a=1<=arguments.length?h.call(arguments,0):[],c="button.btn",this.disabled||(c+=".edge"),this.disabled&&(c+=".active"),b=this._submit_attr(null,{}),f.apply(null,[c,b].concat(h.call(a)))},a.prototype.draw=function(){var a,b,c,d,e;for(this._errors=null,d=this._draws,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(a());return e},a.prototype.draws=function(a){return this._draws.push(a)},a.prototype.errors=function(){var a,b,c,d,e,f;if(this._errors)return this._errors;for(this._errors={},e=this._inputs,c=0,d=e.length;c<d;c++)f=e[c],a=f._id,b=f.dom,(null!=b?b.validationMessage:void 0)&&(this._errors[a]=b.validationMessage);return this._errors},a.prototype.infos=function(){return this._infos},a.prototype.bind=function(a){return this._inputs.push(a)},a.prototype.bundle=function(b){var c,d,e,f;return c=b._id,d=b.attr,a.format(b),f=a.type[d.type],d.multiple&&(f=f.multiple),this.input[c]=e=new f(this,b)},a.prototype._submit=function(a){var b;return this.form=a.form,b={},this.form?this._submit_attr=function(a){return function(b,c){return g(c,{type:"submit",disabled:a.disabled})}}(this):this._submit_attr=function(a){return function(b,c){var d;return d=function(b){return a.do_submit(),!1},g(c,{type:"button",disabled:a.disabled,onclick:d,onmouseup:d,ontouchend:d})}}(this),this},a.prototype.isDirty=function(){var a,b,c,d;for(d=this._inputs,a=0,c=d.length;a<c;a++)if(b=d[a],b.dom&&!b.isDirty())return!1;return!0},a.prototype.isValid=function(){var a;return null!=(a=this.dom)?a.checkValidity():void 0},a.form=function(b,c){return new a({ids:c,params:b})._submit({form:function(){var a,b;return a=arguments[0],b=2<=arguments.length?h.call(arguments,1):[],f("form",e(this,a),b)}})},a.btns=function(b,c){return new a({ids:c,params:b})._submit({})},a.format=function(a){var b,c,d,e,f,g,h;null==a.label&&(a.label={}),null==(c=a.label).attr&&(c.attr={}),(null!=(f=a.attr)?f.name:void 0)&&(null==(d=a.attr).id&&(d.id=a.attr.name),a.label.attr.for=a.attr.name),g=a.options,h=[];for(b in g)e=g[b],e._id||h.push(a.options[b]="object"==typeof e?(e._id=b,e):{_id:b,label:e});return h},a}(),module.exports.InputTie=a}.call(this),function(){var a,b,c,d,e,f,g,h;e=require("lodash"),b=require("memory-record"),c=module.exports.Tie,f=b.unpack.Url,g=b.pack.Url,h=e.debounce(function(){var a;if(a=d.location(),f(location.href)!==f(a.href))return"undefined"!=typeof history&&null!==history&&history[d.mode]("URL",null,a.href),d.popstate()},50),a=function(){function a(a){this.protocol=a.protocol,this.host=a.host,this.pathname=a.pathname,this.search=a.search,this.hash=a.hash,this.href=a.href}return a.now=function(){return new this(location)},a.prototype.each=function(a){var b,e,f,g,h,i,j,k,l;for(i=c.types.url,b=0,f=i.length;b<f;b++)for(k=i[b],j=d.type[k],e=0,g=j.length;e<g;e++)l=j[e],h=this[k],a(l,h,k);return this},a.prototype.fetch=function(){return this.each(function(a,b,c){return a.fetch(b)}),this},a.prototype.view=function(){return this.each(function(a){return function(b,c,d){return a[d]=b.view(c)}}(this)),this.href=this.protocol+"//"+this.host+this.pathname+this.search+this.hash,this},a}(),d=function(){function d(a,c,e){var f;this._id=a,this.type=c,this.format=e,this.keys=[],f=this.format.replace(/[.]/gi,function(a){return"\\"+a}).replace(/:([a-z_]+)/gi,function(a){return function(c,e){var f;return(f=d.define(e))?(a.keys.push(e),b.Serial.url[f.type]):void console.error("undefined key : "+e)}}(this),"i"),this.scanner=new RegExp(f)}var e,i,j,k;for(d.conf={},d.type={},j=c.types.url,e=0,i=j.length;e<i;e++)k=j[e],d.type[k]=[];return d.define=function(a){return b.Query.stores.hash[a]},d.maps=function(a){return this.tie=c.build_url(a,c.params,this),this.prop=this.tie.prop,this.params=c.params},d.popstate=function(){return this._loc=a.now(),this._loc.fetch(),this.mode="replaceState"},d.pushstate=function(){return this.mode="pushState",h()},d.replacestate=function(){return h()},d.location=function(){return null==this._loc&&this.popstate(),this._loc.view()},d.prototype.serialize=function(){var a,c,e,f,h,i;for(f=this.format,h=this.keys,a=0,e=h.length;a<e;a++)c=h[a],i=b.pack[d.define(c).type],f=f.replace(RegExp(":"+c,"gi"),i(d.params[c]));return g(f)},d.prototype.values=function(a){var b,c,e,f,g;for(null==a&&(a={}),f=this.keys,g=[],b=0,e=f.length;b<e;b++)c=f[b],g.push(a[c]||d.params[c]);return g},d.prototype.fetch=function(a){var b,c,e,g,h,i;if(this.match=this.scanner.exec(a),this.match){for(this.match.shift(),h=this.keys,i=[],b=c=0,g=h.length;c<g;b=++c)e=h[b],i.push(d.prop[e](f(this.match[b])));return i}},d.prototype.view=function(a){return this.match=this.scanner.exec(a),this.match?a.replace(this.scanner,this.serialize()):(this.current&&(this.match=!0,a+=function(){if(a.length)return"&";switch(this.type){case"hash":return"#";case"search":return"?"}}.call(this),a+=this.serialize()),a)},d}(),module.exports.Url=d}.call(this),function(){var a,b,c,d;a=module.exports.Tie,d=function(a,b,c,d){return function(e){return arguments.length?a.setItem(b,d(e)):c(a.getItem(b))}},c=function(a,b,c,d){return function(e){var f,g,h,i,j,k,l;return arguments.length?(f=[b+"="+d(e)],l=a.time,g=a.domain,j=a.path,k=a.secure,l&&(h=new Date(Math.min(2147397247e3,Date.now()+36e5*l)),f.push("expires="+h.toUTCString())),g&&f.push("domain="+g),j&&f.push("path="+j),k&&f.push("secure"),document.cookie=f.join("; ")):(i=RegExp(b+"=([^;]+)").exec(document.cookie),null!=(null!=i?i[0]:void 0)?c(i[1]):void 0)}},b=function(){function b(){}return b.maps=function(b){return this.session=a.build_store(b.session,d,sessionStorage),this.local=a.build_store(b.local,d,localStorage),this.cookie=a.build_store(b.cookie,c,this.cookie_options),this.params=a.params},b.copyBy=function(b){var c,d,e,f,g;for(e=a.types.store,f=[],c=0,d=e.length;c<d;c++)g=e[c],f.push(this[g].copyBy(b));return f},b.copyTo=function(b){var c,d,e,f,g;for(e=a.types.store,f=[],c=0,d=e.length;c<d;c++)g=e[c],f.push(this[g].copyTo(b));return f},b.format=function(a){return null==a.type&&(a.type="String"),null!=a.current?a.current:a.current=function(){switch(a.type){case"Keys":return{};case"Date":case"Number":return 0;case"String":return null;case"Text":return""}}()},b}(),module.exports.WebStore=b}.call(this),function(){var a,b,c,e,f,g,h,i,j,k=[].slice;b=require("memory-record"),i=require("mithril"),h=require("lodash"),j=module.exports,a=j.InputTie,e=j.Tie,c=function(){return new Object(null)},g=function(){function a(){this.data=c()}return a.prototype.build=function(){var a,b;return b=1<=arguments.length?k.call(arguments,0):[],this.views=function(){var c,d,e;for(e=[],c=0,d=b.length;c<d;c++)a=b[c],e.push(new a(this.dom));return e}.call(this)},a.prototype.draw=function(a){var b,c,d,e;c=a.is_touch,d=a.offset,e=a.offsets,b=a.history},a.prototype.dom=function(a){var b;return this.dom=a,b=this.build(f),this._view=b[0],b},a.prototype.resize=function(a){return this._view.fit({offset:[0,0],view:[1,1],size:a}),this._view.clear()},a.prototype.background=function(a){var b,d;return null==(b=this.data).canvas&&(b.canvas=c()),(d=this.data.canvas[this._view.size])?void this._view.paste(d,[0,0]):(this.resize(a),this.data?this.data.canvas[this._view.size]=this._view.copy([0,0],[1,1]):void 0)},a.prototype.hit=function(a){return h.some(this.views,function(b){return b.hit(a)})},a.prototype.touch=function(a){return this.hit(a,function(a,b){})},a.prototype.over=function(a){return this.hit(a,function(a,b){})},a}(),f=function(){function a(a){this.draw=a.getContext("2d")}return a.prototype.fit=function(a){var b,c,d,e,f,g;return c=null!=a?a:{},b=c.offset,this.size=c.size,g=c.view,d=this.size,this.show_width=d[0],this.show_height=d[1],e=g||this.size,this.view_width=e[0],this.view_height=e[1],f=b||[0,0],this.left=f[0],this.top=f[1],this.right=this.left+this.show_width,this.bottom=this.top+this.show_height,this.x=this.show_width/this.view_width,this.y=this.show_height/this.view_height},a.prototype.by=function(a,b){return[(a-this.left)/this.x,(b-this.top)/this.y]},a.prototype.at=function(a,b){return[this.left+this.x*a,this.top+this.y*b]},a.prototype.to=function(a,b){return[this.x*a,this.y*b]},a.prototype.pen=function(a){return h.assignIn(this.draw,a)},a.prototype.clear=function(){return this.draw.clearRect(this.left,this.top,this.right,this.bottom)},a.prototype.fill=function(){return this.draw.fillRect(this.left,this.top,this.right,this.bottom)},a.prototype.paste=function(a,b){var c,d;return c=b[0],d=b[1],this.draw.putImageData(a,c,d)},a.prototype.copy=function(a,b){var c,d,e,f,g,h;return c=this.at.apply(this,a),e=c[0],g=c[1],d=this.to.apply(this,b),f=d[0],h=d[1],this.draw.getImageData(e,g,f,h)},a.prototype.text=function(a,b,c){var d,e,f;if(d=this.at.apply(this,b),e=d[0],f=d[1],c=this.x*c-4,4<c)return this.draw.fillText(a,e,f,c)},a.prototype.rect=function(a,b){var c,d,e,f,g,h;return c=this.at.apply(this,a),e=c[0],g=c[1],d=this.at.apply(this,b),f=d[0],h=d[1],this.draw.fillRect(e,g,f,h)},a.prototype.moveTo=function(){var a,b,c;return a=this.at.apply(this,arguments),b=a[0],c=a[1],this.draw.moveTo(b,c)},a.prototype.lineTo=function(){var a,b,c;return a=this.at.apply(this,arguments),b=a[0],c=a[1],this.draw.lineTo(b,c)},a.prototype.path=function(a){return this.draw.beginPath(),a(d),this.draw.stroke()},a.prototype.hit=function(a){var b,c;return this.left<(b=a[0])&&b<this.right&&this.top<(c=a[1])&&c<this.bottom},a.prototype.touch=function(a,b){var c,d,e;if(c=this.by.apply(this,a),d=c[0],e=c[1],this.hit(a))return b(d,e)},a.prototype.over=function(a,b){var c,d,e;if(c=this.by.apply(this,a),d=c[0],e=c[1],this.hit(a))return b(d,e)},a}(),a.util.canvas={View:f,Views:g}}.call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;b=require("memory-record"),a=module.exports.InputTie,new b.Rule("input").schema(function(){return this.scope(function(a){return{checkbox:function(b){return a.where(function(a){return"checkbox"===a.attr.type&&a.sean===b})}}}),this.model=function(b){function d(){a.format(this)}return c(d,b),d}(this.model)})}.call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=require("memory-record"),b=module.exports.WebStore,new a.Rule("store").schema(function(){return this.scope(function(a){}),this.model=function(a){function d(){b.format(this)}return c(d,a),d}(this.model)})}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=[].slice,z=function(a,b){function c(){this.constructor=a}for(var d in b)A.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},A={}.hasOwnProperty;for(b=require("memory-record"),r=require("mithril"),d=require("lodash"),u=module.exports,a=u.InputTie,c=u.Tie,m=function(a,b){return d.assignIn.apply(d,[{}].concat(y.call(a),[b]))},t=function(){var a;return a=1<=arguments.length?y.call(arguments,0):[],a=a.map(function(a){var b;return b=["id","className","selected","disabled","value","label"],a.badge&&b.push("badge"),d.pick(a,b)}),d.assignIn.apply(d,a)},e=function(){var a;return a=1<=arguments.length?y.call(arguments,0):[],d.assignIn.apply(d,a)},g=function(){var a,b,c,d,e,f;return b=1<=arguments.length?y.call(arguments,0):[],e=c=this,a=e._value,f=e.tie,d=m(b,{config:this.__config,disabled:f.disabled,onblur:function(a){return f.do_blur(c,a)},onfocus:function(a){return f.do_focus(c,a)},onselect:function(a){return f.do_select(c,a)},onchange:function(b){return f.do_change(c,a(b),d)},oninvalid:function(b){return f.do_fail(c,a(b),d)}})},l=function(){var a,b,c,d,e,f;return b=1<=arguments.length?y.call(arguments,0):[],e=c=this,a=e._value,f=e.tie,d=m(b,{config:this.__config,disabled:f.disabled,onblur:function(a){return f.do_blur(c,a)},onfocus:function(a){return f.do_focus(c,a)},onselect:function(a){return f.do_select(c,a)},oninput:function(b){return f.do_change(c,a(b),d)},oninvalid:function(b){return f.do_fail(c,a(b),d)}})},h=function(a){return(a.currentTarget||this).checked},j=function(a){return(a.currentTarget||this).value},i=function(a){var b,c,d,e,f;for(d=(a.currentTarget||this).selectedOptions,e={},b=0,c=d.length;b<c;b++)f=d[b],e[f.value]=!0;return e},x={valid:"valid",valueMissing:"required",typeMismatch:"type",patternMismatch:"pattern",rangeUnderflow:"min",rangeOverflow:"max",stepMismatch:"step",tooLines:"max_line",tooLong:"maxlength",tooShort:"minlength",hasSecret:"not_secret",hasPlayer:"not_player"},f=function(){function f(a,e){var f,g,h;this.tie=a,this.format=e,h=this.format,this._id=h._id,this.options=h.options,this.attr=h.attr,this.name=h.name,this.current=h.current,f=h.info,g=h.option_default,this.__info=f,this.__uri=b.pack[this.type],this.__val=b.unpack[this.type],this.__config=this._config.bind(this),this.tie.bind(this),this.option_default=d.assign({},this.option_default,g),c.build_input(this.tie.tie,this._id,this.tie.params,this),this.default=this.value(),this.do_draw(),this.tie.do_change(this,this.default)}return f.prototype._attr_label=e,f.prototype._value=j,f.prototype._attr=l,f.prototype._debounce=a.prototype._debounce,f.prototype._config=function(a,b,c){var d,e,f;if(this.dom=a,!b)return null==(d=this.dom).validity&&(d.validity={valid:!0}),null==(e=this.dom).checkValidity&&(e.checkValidity=function(){return this.validity.valid}),null!=(f=this.dom).setCustomValidity?f.setCustomValidity:f.setCustomValidity=function(a){return this.validationMessage=a,this.validationMessage?(this.validity.customError=!0,this.validity.valid=!1):(this.validity.customError=!1,this.validity.valid=!0)}},f.prototype.timeout=100,f.prototype.type="String",f.prototype.option_default={className:"icon-cancel-alt",label:""},f.prototype.info=function(a){return null==a&&(a=""),this.tie._infos[this._id]=a},f.prototype.error=function(a){var b;return null==a&&(a=""),null!=(b=this.dom)?b.setCustomValidity(a):void 0},f.prototype.value=function(a){return arguments.length&&this.tie.do_change(this,this.__val(a)),this.tie.params[this._id]},f.prototype.isDirty=function(){return this.default===this.value()},f.prototype.isValid=function(){var a;return null!=(a=this.dom)?a.checkValidity():void 0},f.prototype.do_fail=function(a){},f.prototype.do_focus=function(){},f.prototype.do_blur=function(){},f.prototype.do_draw=function(){var a,b,c,d;return c=this.format,a=c.info,b=c.label,this.__name=this.attr.name||this._id,this.__value=this.value(),this.tie.errors[this._id]=(null!=(d=this.dom)?d.validationMessage:void 0)||""},f.prototype.do_change=function(a){var b,c,d,e;if(this.dom&&!this.dom.validity.customError&&this.format.error){d=this.dom.validity;for(b in d)if(e=d[b],e&&(c=this.format.error[x[b]]))return void this.error(c)}},f.prototype.option=function(a){var b;return a?(null!=(b=this.options)?b[a]:void 0)||{}:this.option_default},f.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=t(this.attr,b,d,{className:[d.className,b.className].join(" "),value:this.__uri(a),selected:a===this.__value}),r("option",c,c.label)},f.prototype.datalist=function(a){throw null==a&&(a={}),"not implement"},f.prototype.head=function(a){var b;return null==a&&(a={}),b=this._attr_label(a),r("label",b,this.name)},f.prototype.label=function(a){var b,c,d,e;return null==a&&(a={}),this.label_for&&this.options&&(d=this.options[this.__value])?this.label_for(d):(b=this.__info)?(b.label&&(e=b.label),b.off&&!this.__value&&(e=b.off),b.on&&this.__value&&(e=b.on),b.valid&&this.__value&&(e=b.valid),c=this._attr_label(a,this.format.label.attr),r("label",c,e)):void 0},f.prototype.field=function(a){var b;return null==a&&(a={}),b=this._attr(this.attr,a,{className:[this.attr.className,a.className].join(" "),name:this.__name,value:this.__value}),r("input",b)},f}(),s=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.type="Number",b}(f),v=["hidden","tel","password","datetime","date","month","week","time","datetime-local","color"],k=0,p=v.length;k<p;k++)o=v[k],a.type[o]=f;for(w=["number","range"],n=0,q=w.length;n<q;n++)o=w[n],a.type[o]=s;a.type.checkbox=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype._value=h,b.prototype._attr=g,b.prototype.type="Bool",b.prototype.option=function(a){var b,c;return c=a?"on":"off",(null!=(b=this.options)?b[c]:void 0)||{}},b.prototype.field=function(a){var b,c;return null==a&&(a={}),c=this.option(this.__value),b=this._attr(this.attr,a,{className:[this.attr.className,a.className].join(" "),type:"checkbox",name:this.__name,value:this.__uri(this.__value),checked:this.__value}),r("input",b)},b}(f),a.type.radio=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype._value=j,b.prototype._attr=g,b.prototype.field=function(a){var b,c,d;return null==a&&(a={}),b=function(){var b,e;b=this.options,e=[];for(d in b)c=b[d],c.hidden||e.push(this.item(d,a));return e}.call(this),this.attr.required&&this.format.current||b.unshift(this.item("",a)),b},b.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=this._attr(this.attr,b,d,{className:[this.attr.className,d.className,b.className].join(" "),type:"radio",name:this.__name,value:this.__uri(a),checked:a===this.__value}),r("input",c,d.label,d.badge?r(".emboss.pull-right",d.badge()):void 0)},b}(f),a.type.select=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype._value=j,b.prototype._attr=g,b.prototype.option_default={className:"",label:"―――"},b.prototype.field=function(a){var b,c,d,e;return null==a&&(a={}),b=function(){var b,c;b=this.options,c=[];for(e in b)d=b[e],d.hidden||c.push(this.item(e,a));return c}.call(this),this.attr.required&&this.format.current||b.unshift(this.item("",a)),c=this._attr(this.attr,a,{className:[this.attr.className,a.className].join(" "),name:this.__name}),r("select",c,b)},b}(f),a.type.select.multiple=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype._value=i,b.prototype._attr=g,b.prototype.field=function(a){var b,c,d;return null==a&&(a={}),b=this._attr(this.attr,a,{className:[this.attr.className,a.className].join(" "),name:this.__name}),r("select",b,function(){var a,b;a=this.options,b=[];for(d in a)c=a[d],c.hidden||b.push(this.item(d));return b}.call(this))},b.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=t(this.attr,b,d,{className:[d.className,b.className].join(" "),value:this.__uri(a),selected:this.__value[a]}),r("option",c,c.label)},b}(f)}.call(this),function(){var a,b,c,d,e,f,g,h,i=[].slice,j=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},k={}.hasOwnProperty;h=require("mithril"),b=require("lodash"),a=module.exports.InputTie,c=function(a,c){return a=a.map(function(a){var c;return c=["id","className"],a.title&&c.push("title"),null!=a["data-tooltip"]&&c.push("data-tooltip"),b.pick(a,c)}),b.assignIn.apply(b,i.call(a).concat([c]))},f=function(a,b,c){return c?b.push(c):b.pop(),b},g=function(a,b){return b},e=function(a,b){return a?null:b},d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._attr=function(){var a,b,d,e,f,g,h,j,k,l,m,n,o,p,q;return b=2<=arguments.length?i.call(arguments,0,h=arguments.length-1):(h=0,[]),j=arguments[h++],m=d=this,a=m._id,p=m.tie,e=j.className,g=j.disabled,n=j.selected,q=j.value,o=j.target,l=function(){if(!d.timer)return d._debounce().catch(function(){return d.timer=null}),q=d._value(n,q,o),p.do_change(d,q,k),d.dom.validity.valid?void 0:p.do_fail(d,q,k)},f="btn",g||p.disabled||(f+=" edge"),n&&(f+=" active"),e&&(f+=" "+e),k=c(b,{config:this.__config,className:f,onclick:l,onmouseup:l,ontouchend:l})},b.prototype.do_change=function(a){var c,d,e,f;return e=this.attr,d=e.pattern,f=e.required,this.dom&&(f&&!a&&(c="このフィールドを入力してください。"),d&&a.match(new Regexp(d))&&(c="指定されている形式で入力してください。"),this.error(c)),b.__super__.do_change.apply(this,arguments)},b.prototype.head=function(a){var b,c;return null==a&&(a={}),c=this.format.name,b=this._attr_label(a),h("h6",b,c)},b}(a.type.hidden),a.type.toggle=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._value=g,b.prototype.field=function(a){var b,c,d;return null==a&&(a={}),c=this.__value,d=this.option(c),b=this._attr(this.attr,a,{className:[this.attr.className,a.className].join(" "),value:c}),h("span",b,d.label,d.badge?h(".emboss.pull-right",d.badge()):void 0)},b}(d),a.type.checkbox_btn=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._value=g,b.prototype.type="Bool",b.prototype.option=function(a){var b,c;return c=a?"on":"off",(null!=(b=this.options)?b[c]:void 0)||{}},b.prototype.field=function(a){var b,c;return null==a&&(a={}),c=this.option(this.__value),b=this._attr(this.attr,a,{className:[this.attr.className,a.className].join(" "),selected:this.__value,value:this.__value}),h("span",b,this.__name,c.badge?h(".emboss.pull-right",c.badge()):void 0)},b}(d),a.type.icon=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}var c,d,f;return j(b,a),b.prototype._value=e,b.prototype.option_default={className:"",label:"","data-tooltip":"選択しない"},b.prototype.field=function(a){throw null==a&&(a={}),"not implement"},b.prototype.with=function(a,b){var c;switch(c=this.__value===a,b){case c:return this._with[a]();case!c:return null;default:return this._with={},this._with[a]=b}},b.prototype.item=function(a,b){var c,d,e;return null==b&&(b={}),d=this.option(a),e=b.tag||"menuicon",c=this._attr(this.attr,b,d,{className:[this.attr.className,b.className,d.className].join(" "),selected:a===this.__value,value:a}),f[e](a,c,d)},d=function(a,b,c){return h("a.menuicon",b,h("span.icon-"+a),c.badge?h(".emboss.pull-right",c.badge()):void 0)},c=function(a,b,c){return h("section",b,h(".bigicon",h("span.icon-"+a)),c.badge?h(".badge.pull-right",c.badge()):void 0)},f={menuicon:d,bigicon:c},b}(d),a.type.btns=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._value=g,b.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=this._attr(this.attr,b,d,{className:[this.attr.className,d.className,b.className].join(" "),selected:a===this.__value,value:a}),h("span",c,d.label,d.badge?h(".emboss.pull-right",d.badge()):void 0)},b.prototype.field=function(a){var b,c,d;return null==a&&(a={}),b=function(){var b,e;b=this.options,e=[];for(d in b)c=b[d],c.hidden||e.push(this.item(d,a));return e}.call(this),this.attr.required&&this.format.current||b.unshift(this.item("",a)),b},b}(d),a.type.btns.multiple=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._value=g,b.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=this._attr(this.attr,b,d,{className:[this.attr.className,d.className,b.className].join(" "),selected:this.__value[a],value:this.__value[a]}),h("span",c,d.label,d.badge?h(".emboss.pull-right",d.badge()):void 0)},b.prototype.field=function(a){var b,c,d,e,f,g,h;null==a&&(a={}),e=this.format,b=e._id,c=e.attr,this.__values=this.tie.params[b],f=this.options,g=[];for(h in f)d=f[h],d.hidden||g.push(this.item(h,a));return g},b}(d),a.type.stack=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._value=f,b.prototype.type="Array",b.prototype.field=function(a){throw null==a&&(a={}),"not implement"},b.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=this._attr(this.attr,b,d,{className:[this.attr.className,d.className,b.className].join(" "),target:a,value:this.__value}),h("span",c,d.label,d.badge?h(".emboss.pull-right",d.badge()):void 0)},b.prototype.back=function(a){return null==a&&(a={}),this.item("",a)},b}(d)}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=[].slice,s=function(a,b){function c(){this.constructor=a}for(var d in b)t.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},t={}.hasOwnProperty;b=require("memory-record"),j=require("mithril"),f=require("lodash"),l=module.exports,a=l.InputTie,e=l.Tie,console.warn("deploy"),d=function(){return 1},p=q=function(){return 0},module.exports.deploy=function(a){var b;b=a.window,d=function(){return b.devicePixelRatio},p=function(){return b.scrollX},q=function(){return b.scrollY}},c=function(){return new Object(null)},i=function(a,b){var c,d,e,f;return d=a.dom,c=a.ctx,c.offset=null,c.offsets=[],null==b||null==c?c.offsets:(null!=b.touches?(f=d.getBoundingClientRect(),c.offsets=function(){var a,c,d,g;for(d=b.touches,g=[],a=0,c=d.length;a<c;a++)e=d[a],g.push(m(e,f));return g}(),1===b.touches.length&&(c.offset=c.offsets[0])):(c.offset=k(b),null!=c.offset&&(c.offsets=[c.offset])),c.history.push(c.offsets))},k=function(a){var b,c;if(b=a.offsetX||a.layerX,c=a.offsetY||a.layerY,null!=b&&null!=c)return b*=d(),c*=d(),[b,c]},n=function(a,b){var c,e,f,g,h,i;return e=a.pageX,f=a.pageY,c=b.left,g=b.top,h=d()*(e-c-p()),i=d()*(f-g-q()),[h,i]},o=function(a,b){var c,e,f,g,h,i;return e=a.pageX,f=a.pageY,c=b.left,g=b.top,h=d()*(e-c),i=d()*(f-g-q()),[h,i]},m=o,g=function(a,b){return f.assignIn.apply(f,[{}].concat(r.call(a),[b]))},h=function(){var a,b,c,d,f;return f=e.browser,c=f.ios,b=f.ff,d=f.old,a=f.chrome,m=c||b||d&&a?n:o},a.type.canvas=function(b){function c(){this.views=new this._views(this),c.__super__.constructor.apply(this,arguments)}return s(c,b),c.prototype.type="Array",c.prototype._views=a.util.canvas.Views,c.prototype._config=function(a,b,d){return this.ctx=d,c.__super__._config.apply(this,arguments),b||(this.views.dom(this.dom),this.do_blur()),this.views.background(this.size)},c.prototype.do_draw=function(){},c.prototype.do_focus=function(a){return this.ctx.is_touch=!0},c.prototype.do_blur=function(a){return this.ctx.is_touch=!1,this.ctx.history=[],this.views.draw(this.ctx)},c.prototype.do_move=function(){var a,b,c,d,e;return e=this.ctx,b=e.is_touch,c=e.offset,d=e.offsets,a=e.history,c&&(b?this.views.touch(c):this.views.over(c)),this.views.draw(this.ctx),this.tie.do_change(this,this._value(this.ctx))},c.prototype.do_fail=function(a){},c.prototype.do_change=function(a){},c.prototype._value=function(a){return a.offset},c.prototype._attr=function(){var a,b,c,d,e,f,h,j,k,l,m;return b=1<=arguments.length?r.call(arguments,0):[],l=c=this,a=l._value,m=l.tie,f=l.ctx,h=function(a){return m.do_focus(c,a),k(a)},d=function(a){return k(a),m.do_blur(c,a)},k=function(a){return i(c,a),c.do_move()},e=function(b){return i(c,b),m.do_fail(c,a(c.ctx)),m.do_blur(c,b)},j=g(b,{config:this.__config,ontouchend:d,ontouchmove:k,ontouchstart:h,ontouchcancel:e,onmouseup:d,onmousemove:k,onmousedown:h,onmouseout:d,onmouseover:k})},c.prototype.field=function(a){var b,c,e,f;return null==a&&(a={}),e=this.size=a.size||this.attr.size,f=e[0],b=e[1],c=this._attr(this.attr,a,{className:[this.attr.className,a.className].join(" "),width:f,height:b,style:"width: "+f/d()+"px; height: "+b/d()+"px;"}),j("canvas",c)},c}(a.type.hidden)}.call(this),function(){var a,b,c,d,e,f,g,h,i=[].slice,j=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},k={}.hasOwnProperty;f=require("mithril"),h=module.exports,b=h.InputTie,c=h.Tie,d=function(a,b){return _.assignIn.apply(_,[{}].concat(i.call(a),[b]))},g=function(a){return new fabric.Canvas(a,{enableRetinaScaling:!0})},e=function(){if(!fabric)throw"require fabric.js"},a=function(){function a(a,b){this.tie=a,this.input=b}return a.prototype.type="String",a.prototype.do_draw=function(){},
a.prototype.do_focus=function(a){},a.prototype.do_blur=function(a){},a.prototype.do_fail=function(a){},a.prototype.do_change=function(a){},a.prototype.deploy=function(a,b){},a.prototype.redraw=function(a,b){},a.prototype.resize=function(a,b){},a}(),b.type.fabric=function(c){function h(){h.__super__.constructor.apply(this,arguments),this.size_old=[0,0],this.view=new this._view(this.tie,this),this.view.__val=this.__val}return j(h,c),h.extend=function(a,c){return e(),b.type[a]=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype.type=c.prototype.type,b.prototype._view=c,b}(this)},h.prototype.type="Array",h.prototype._view=a,h.prototype._config=function(a,b,c){var d,e,f;return h.__super__._config.apply(this,arguments),e=this.size,f=e[0],d=e[1],b||(this.canvas=g(a),this.view.deploy(this.canvas,this.size)),this.size[0]===this.size_old[0]&&this.size[1]===this.size_old[1]?(this.canvas.renderAll(),this.view.redraw(this.canvas,this.size)):(this.canvas.setWidth(f),this.canvas.setHeight(d),console.log("resize "+[f,d]),this.view.resize(this.canvas,this.size)),this.size_old=this.size},h.prototype.do_draw=function(){},h.prototype.do_focus=function(a){},h.prototype.do_blur=function(a){},h.prototype.do_fail=function(a){},h.prototype.do_change=function(a){},h.prototype._value=function(a){return a.offset},h.prototype._attr=function(){var a,b,c,e,f,g,h;return b=1<=arguments.length?i.call(arguments,0):[],g=c=this,a=g._value,h=g.tie,e=g.ctx,f=d(b,{config:this.__config})},h.prototype.field=function(a){var b,c,d,e;return null==a&&(a={}),d=this.size=a.size||this.attr.size,e=d[0],b=d[1],c=this._attr(this.attr,a,{className:[this.attr.className,a.className].join(" "),width:e,height:b}),f("canvas",c)},h}(b.type.hidden)}.call(this),function(){var a,b,c,d,e,f,g,h,i,j=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},k={}.hasOwnProperty;for(f=require("mithril"),b=require("lodash"),a=module.exports.InputTie,i=function(a){var b;return b=20,50<a&&(b+=(a-50)/14),Math.floor(b)},h=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return j(c,b),c.prototype.do_draw=function(){var a,b,c,d,e;return e=this.attr.unit,this.__name=this.attr.name||this._id,this.__value=this.tie.params[this._id],c=this.__value.length,d=this.__value.sjis_length,a=this.__value.split("\n").length,"point"===e&&(b=i(d)),this.calc={point:b,line:a,sjis:d,size:c}},c.prototype.do_change=function(b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;return m=this.attr,k=m.not_secret,j=m.not_player,r=m.unit,g=m.max_sjis,f=m.max_line,i=m.minlength,h=m.maxlength,l=m.pattern,p=m.required,n=this.calc,e=n.line,q=n.sjis,this.dom&&(k&&b.match(/>>[\=\*\!]\d+/g)&&(d="あぶない！秘密会話へのアンカーがあります！"),j&&b.match(/\/\*|\*\//g)&&(d="/*中の人の発言があります。*/"),f&&f<e&&(d="このテキストを "+f+" 行以下にしてください。"),g&&g<q&&(d="このテキストを "+g+" 文字以下にしてください。"),i&&0<(o=b.length)&&o<i&&(a.skip_minlength||(d="このテキストは "+i+" 文字以上で指定してください（現在は "+b.length+" 文字です）。")),this.error(d)),c.__super__.do_change.apply(this,arguments)},c.prototype.foot=function(a){var b,c,d,e;return null==a&&(a={}),b=this._attr_label(this.attr,a),e=this.calc.size,b.maxlength&&(d=b.maxlength),b.max_sjis&&(e=this.calc.sjis,d=b.max_sjis),c=this.calc.point?f("span.emboss",this.calc.point+"pt "):"",this.dom&&!this.dom.validationMessage||(c=f("span.WSAY.emboss","⊘")),[c," "+e,null!=d?f("sub","/"+d):void 0,f("sub","字")," "+this.calc.line,null!=b.max_line?f("sub","/"+b.max_line):void 0,f("sub","行")]},c}(a.type.hidden),a.type.textarea=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype.field=function(a){var b;return null==a&&(a={}),b=this._attr(this.attr,a,{className:[this.attr.className,a.className].join(" "),name:this.__name}),f("textarea",b,this.__value)},b}(h),g=["text","search","url","email"],c=0,e=g.length;c<e;c++)d=g[c],a.type[d]=h}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=function(a,b){function c(){this.constructor=a}for(var d in b)o.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},o={}.hasOwnProperty;b=require("memory-record"),i=require("mithril"),h=require("lodash"),k=module.exports,a=k.InputTie,d=k.Tie,c=function(){return new Object(null)},m=36e5,j=["SAY","MSAY","VSAY","VGSAY","GSAY","SPSAY","WSAY","XSAY","BSAY","AIM","TSAY","MAKER","ADMIN"],l=a.util.canvas,f=l.View,g=l.Views,e=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return n(c,a),c.prototype.dom=function(a){var b;return this.dom=a,c.__super__.dom.apply(this,arguments),b=this.build(f,f),this.field=b[0],this.foots=b[1],b},c.prototype.resize=function(a){var d,e,f,g,i,k,l,m,n,o,p,q,r;if(c.__super__.resize.apply(this,arguments),this.base=b.Query.messages.talk(talk(),open(),potofs_hide()),base.reduce){for(this.masks=this.base.reduce.mask||{},e=function(){var a,b;a=this.masks,b=[];for(p in a)m=a[p],b.push(m.all.count);return b}.call(this),n=Math.max.apply(Math,e),this.time_ids=h.sortBy(Object.keys(this.masks),b.unpack.Date),r=a[0],d=a[1],this.field.fit({size:[r,d-50],view:[this.time_ids.length,n]}),this.foots.fit({offset:[0,d-50],size:[r,50],view:[this.time_ids.length,1]}),this.field.pen({fillStyle:RAILS.log.colors.back,globalAlpha:.5}),this.field.fill(),i=f=0,k=time_ids.length;f<k;i=++f)for(p=time_ids[i],m=masks[p],q=n,g=0,l=j.length;g<l;g++)o=j[g],m[o]&&(d=m[o].count,q-=d,this.field.pen({fillStyle:RAILS.log.colors[o],globalAlpha:1}),this.field.rect([i,q],[1,d]));return this.foots.path(function(a){return function(){var c,d,e,f,g,h;for(f=b.Query.events.list,g=[],d=0,e=f.length;d<e;d++)c=f[d],c.created_at&&(h=index_at(c.updated_at),i=index_at(c.created_at),a.foots.pen({strokeStyle:RAILS.log.colors.line,globalAlpha:1}),a.foots.moveTo(i,1),a.foots.lineTo(i,0),a.foots.moveTo(h,1),a.foots.lineTo(h,0),a.foots.pen({fillStyle:RAILS.log.colors.event}),a.foots.fill(),a.foots.pen({font:"30px serif",textAlign:"left",fillStyle:RAILS.log.colors.text}),g.push(a.foots.text(c.name,[i,38],h-i)));return g}}(this))}},c.prototype.draw=function(a){var c,d;if(this.ctx=a,c=b.Query.messages.find(Url.params.talk_at))return d=this.index(c.updated_at),this.field.path(function(a){return function(){return a.field.pen({strokeStyle:RAILS.log.colors.focus,globalAlpha:1}),a.field.moveTo(d,a.show_height),a.field.lineTo(d,0)}}(this))},c.prototype.index=function(a){return this.time_ids.indexOf(b.pack.Date(a/m))},c.prototype.choice=function(a,b){var c,d;return c=Math.floor(a),d=this.masks[this.time_ids[c]].all.min_is,Url.params.talk_at=d._id,Url.params.icon("search"),Url.params.scope("talk"),Url.params.scroll(""),win.scroll.rescroll(Url.prop.talk_at)},c.prototype.touch=function(a){return Url.params.search="",this.field.touch(a,function(a){return function(b){return a.choice(b,base)}}(this)),this.foots.touch(a,function(a){return function(c){return a.choice(c,b.Query.messages.talk("open",!1,{}))}}(this))},c}(g),a.type.timeline=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return n(b,a),b.prototype.type="Array",b.prototype._graph=e,b}(a.type.canvas)}.call(this);
//# sourceMappingURL=mithril-tie.min.js.map