/**
 mithril-tie - browser input helper for mithril
 @version v0.0.5
 @link https://github.com/7korobi/mithril-tie
 @license 
**/


(function(){module.exports={}}).call(this),function(){var a,b,c;a=require("memory-record"),c=function(a,b,c){return function(d){return arguments.length?a[b]=c(d):a[b]}},b=function(){function b(){this.prop={}}return b.browser={},b.types={url:["protocol","host","pathname","search","hash","href"],store:["session","local","cookie"]},b.build_input=function(a,b,d,e){return a.deploy(c,d,e),a},b.build_url=function(d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r;for(q=new b,n=b.types.url,j=0,l=n.length;j<l;j++)if(r=n[j],i=d[r])for(g in i)h=i[g],f.conf[g]||f.type[r].push(f.conf[g]=new f(g,r,h));for(o=a.Query.stores.list,k=0,m=o.length;k<m;k++)p=o[k],q.deploy(c,e,p);return q},b.build_store=function(c,d,e){var f,g,h,i,j;for(null==c&&(c=[]),j=new b,h=a.Query.stores.where({_id:c}).list,f=0,g=h.length;f<g;f++)i=h[f],j.deploy(d,e,i);return j},b.prototype.deploy=function(b,c,d){var e,f,g,h,i,j;switch(e=d._id,f=d.current,h=d.type,null==f&&(f=null),i=a.unpack[h],g=a.pack[h],this.prop[e]=b(c,e,i,g),j=this.prop[e]()){case void 0:case null:case"":return this.prop[e](j=f)}},b.prototype.copyBy=function(a){var b,c,d,e;d=this.prop,e=[];for(b in d)c=d[b],e.push(c(a.prop[b]()));return e},b.prototype.copyTo=function(a){var b,c,d,e;d=this.prop,e=[];for(b in d)c=d[b],e.push(a.prop[b](c()));return e},b}(),b.params={},module.exports.Tie=b}.call(this),function(){var a,b,c,d,e,f,g,h=[].slice;b=require("memory-record"),f=require("mithril"),d=require("lodash"),c=module.exports.Tie,g=function(){var a;return a=1<=arguments.length?h.call(arguments,0):[],d.assignIn.apply(d,a)},e=function(a,b){var c,e;return c=b.attr,e=d.assignIn(c,{config:a._config(),disabled:a.disabled,onsubmit:function(b){return a.do_submit(),!1}})},a=function(){function a(a){var d,e,f,g;for(this.params=a.params,f=a.ids,this.off(),this._draw=[],this.input={},this.tie=new c,this.prop=this.tie.prop,d=0,g=f.length;d<g;d++)e=f[d],this.bundle(b.Query.inputs.find(e))}return a.prototype.timeout=1e3,a.prototype._debounce=function(){return this.timer=!0,new Promise(function(a){return function(b,c){return a.timer=setTimeout(function(){return c("reset "+a.timeout+"ms ")},a.timeout)}}(this))},a.prototype._config=function(a){return function(b){return function(c,d,e){return d&&(b.do_dom(a,c,e),e.onunload=function(){return b.do_context(a),b.do_dom(a)}),b.do_context(a,e)}}(this)},a.prototype.do_context=function(a,b){var c;return c=this.input[a],c.do_context(b)},a.prototype.do_dom=function(a,b,c){var d;return d=this.input[a],b&&(null==b.validity&&(b.validity={valid:!0}),null==b.checkValidity&&(b.checkValidity=function(){return this.validity.valid}),null==b.setCustomValidity&&(b.setCustomValidity=function(a){return this.validationMessage=a,this.validationMessage?(this.validity.customError=!0,this.validity.valid=!1):(this.validity.customError=!1,this.validity.valid=!0)})),d.do_dom(b,c)},a.prototype.do_change=function(a,b){var c,d;return c=this.input[a],b=c.__val(b),c.do_change(b),d=this.params[a],d===b?this.stay(a,b):(this.params[a]=b,this.change(a,b,d)),this.disabled=!!this.timer},a.prototype.do_fail=function(a,b){var c;return c=this.input[a],b=c.__val(b),c.do_fail(b)},a.prototype.do_blur=function(a,b){var c;return c=this.input[a],c.do_blur(b),this.focus(a,!1)},a.prototype.do_focus=function(a,b){var c;return c=this.input[a],c.do_focus(b),this.focus(a,!0,this.focus_id,this.focused),this.focus_id=a,this.focused=this.input[a]},a.prototype.do_select=function(a,b){var c,d,e,f;return f=getSelection(),c=f.anchorOffset,d=f.focusOffset,e=[c,d].sort(),this.select(a,f.toString(),e)},a.prototype.do_submit=function(){var a,b,c;if(!this.timer&&this.dom.checkValidity())return b=this._debounce(),a=c=this.action(),null==this.action.then&&(a=new Promise(function(a){return a(c)})),this.on(),f.redraw(),Promise.race([b,a]).then(function(a){return function(){return clearTimeout(a.timer)}}(this))["catch"](function(a){return function(b){return a.message=b,console.log(a.message)}}(this)).then(function(a){return function(){return a.off(),f.redraw()}}(this))},a.prototype.action=function(){},a.prototype.disable=function(a,b){},a.prototype.focus=function(a,b,c){},a.prototype.stay=function(a,b){},a.prototype.change=function(a,b,c){},a.prototype.select=function(a,b,c){},a.prototype.off=function(){return this.disabled=!1,this.disable(!1),this.timer=null},a.prototype.on=function(){return this.disabled=!0,this.disable(!0)},a.prototype.cancel=function(){return clearTimeout(this.timer),this.off()},a.prototype.errors=function(a){var b,c,d,e,f,g;e=this.input,g=[];for(c in e)f=e[c],d=f.name,b=f.dom,(null!=b?b.validationMessage:void 0)&&g.push(a(b.validationMessage,d));return g},a.prototype.infos=function(a){var b,c,d,e,f,g;e=this.input,g=[];for(b in e)f=e[b],d=f.name,c=f.info_msg,c&&(c?g.push(a(c,d)):g.push(void 0));return g},a.prototype.submit=function(){var a,b,c;return a=1<=arguments.length?h.call(arguments,0):[],c="button.btn",this.disabled||(c+=".edge"),this.disabled&&(c+=".active"),b=this._submit_attr(null,{}),f.apply(null,[c,b].concat(h.call(a)))},a.prototype.draw=function(){var a,b,c,d,e;for(d=this._draw,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(a());return e},a.prototype.do_draw=function(a){return this._draw.push(a)},a.prototype.bundle=function(b){var d,e,f,g;return d=b._id,e=b.attr,a.format(b),g=a.type[e.type],e.multiple&&(g=g.multiple),this.input[d]=f=new g(this,b),c.build_input(this.tie,d,this.params,f),f.do_draw(),this.do_change(d,this.params[d]),f},a.prototype._submit=function(a){var b;return this.form=a.form,b={},this._submit_attr=this.form?function(a,b){return g(b,{type:"submit",disabled:this.disabled})}:function(a,b){var c;return this.do_dom(null,{}),c=function(a){return function(b){return a.do_submit(),!1}}(this),g(b,{type:"button",disabled:this.disabled,onclick:c,onmouseup:c,ontouchend:c})},this},a.form=function(b,c){return new a({ids:c,params:b})._submit({form:function(){var a,b;return a=arguments[0],b=2<=arguments.length?h.call(arguments,1):[],f("form",e(this,a),b)}})},a.btns=function(b,c){return new a({ids:c,params:b})._submit({})},a.format=function(a){var b,c,d,e,f,g,h;null==a.label&&(a.label={}),null==(c=a.label).attr&&(c.attr={}),(null!=(f=a.attr)?f.name:void 0)&&(null==(d=a.attr).id&&(d.id=a.attr.name),a.label.attr["for"]=a.attr.name),g=a.options,h=[];for(b in g)e=g[b],e._id||h.push(a.options[b]="object"==typeof e?(e._id=b,e):{_id:b,label:e});return h},a.type={},a}(),module.exports.InputTie=a}.call(this),function(){var a,b,c,d,e,f,g,h;e=require("lodash"),b=require("memory-record"),c=module.exports.Tie,f=b.unpack.Url,g=b.pack.Url,h=e.debounce(function(){var a;if(a=d.location(),f(location.href)!==f(a.href))return console.warn("url changed."),"undefined"!=typeof history&&null!==history&&history[d.mode]("URL",null,a.href),d.popstate()},50),a=function(){function a(a){this.protocol=a.protocol,this.host=a.host,this.pathname=a.pathname,this.search=a.search,this.hash=a.hash,this.href=a.href}return a.now=function(){return new this(location)},a.prototype.each=function(a){var b,e,f,g,h,i,j,k,l;for(i=c.types.url,b=0,f=i.length;b<f;b++)for(k=i[b],j=d.type[k],e=0,g=j.length;e<g;e++)l=j[e],h=this[k],a(l,h,k);return this},a.prototype.fetch=function(){return this.each(function(a,b,c){return a.fetch(b)}),this},a.prototype.view=function(){return this.each(function(a){return function(b,c,d){return a[d]=b.view(c)}}(this)),this.href=this.protocol+"//"+this.host+this.pathname+this.search+this.hash,this},a}(),d=function(){function d(a,c,e){var f;this._id=a,this.type=c,this.format=e,this.keys=[],f=this.format.replace(/[.]/gi,function(a){return"\\"+a}).replace(/:([a-z_]+)/gi,function(a){return function(c,e){var f;return(f=d.define(e))?(a.keys.push(e),b.Serial.url[f.type]):void console.error("undefined key : "+e)}}(this),"i"),this.scanner=new RegExp(f)}var e,i,j,k;for(d.conf={},d.type={},j=c.types.url,e=0,i=j.length;e<i;e++)k=j[e],d.type[k]=[];return d.define=function(a){return b.Query.stores.hash[a]},d.maps=function(a){return this.tie=c.build_url(a,c.params,this),this.prop=this.tie.prop,this.params=c.params},d.popstate=function(){return this._loc=a.now(),this._loc.fetch(),this.mode="replaceState"},d.pushstate=function(){return this.mode="pushState",h()},d.replacestate=function(){return h()},d.location=function(){return null==this._loc&&this.popstate(),this._loc.view()},d.prototype.serialize=function(){var a,c,e,f,h,i;for(f=this.format,h=this.keys,a=0,e=h.length;a<e;a++)c=h[a],i=b.pack[d.define(c).type],f=f.replace(RegExp(":"+c,"gi"),i(d.params[c]));return g(f)},d.prototype.values=function(a){var b,c,e,f,g;for(null==a&&(a={}),f=this.keys,g=[],b=0,e=f.length;b<e;b++)c=f[b],g.push(a[c]||d.params[c]);return g},d.prototype.fetch=function(a){var b,c,e,g,h,i;if(this.match=this.scanner.exec(a),this.match){for(this.match.shift(),h=this.keys,i=[],b=c=0,g=h.length;c<g;b=++c)e=h[b],i.push(d.prop[e](f(this.match[b])));return i}},d.prototype.view=function(a){return this.match=this.scanner.exec(a),this.match?a.replace(this.scanner,this.serialize()):(this.current&&(this.match=!0,a+=function(){if(a.length)return"&";switch(this.type){case"hash":return"#";case"search":return"?"}}.call(this),a+=this.serialize()),a)},d}(),module.exports.Url=d}.call(this),function(){var a,b,c,d;a=module.exports.Tie,d=function(a,b,c,d){return function(e){return arguments.length?a.setItem(b,d(e)):c(a.getItem(b))}},c=function(a,b,c,d){return function(e){var f,g,h,i,j,k,l;return arguments.length?(f=[b+"="+d(e)],l=a.time,g=a.domain,j=a.path,k=a.secure,l&&(h=new Date(Math.min(2147397247e3,Date.now()+36e5*l)),f.push("expires="+h.toUTCString())),g&&f.push("domain="+g),j&&f.push("path="+j),k&&f.push("secure"),document.cookie=f.join("; ")):(i=RegExp(b+"=([^;]+)").exec(document.cookie),null!=(null!=i?i[0]:void 0)?c(i[1]):void 0)}},b=function(){function b(){}return b.maps=function(b){return this.session=a.build_store(b.session,d,sessionStorage),this.local=a.build_store(b.local,d,localStorage),this.cookie=a.build_store(b.cookie,c,this.cookie_options),this.params=a.params},b.copyBy=function(b){var c,d,e,f,g;for(e=a.types.store,f=[],c=0,d=e.length;c<d;c++)g=e[c],f.push(this[g].copyBy(b));return f},b.copyTo=function(b){var c,d,e,f,g;for(e=a.types.store,f=[],c=0,d=e.length;c<d;c++)g=e[c],f.push(this[g].copyTo(b));return f},b.format=function(a){return null==a.type&&(a.type="String"),null!=a.current?a.current:a.current=function(){switch(a.type){case"Keys":return{};case"Date":case"Number":return 0;case"String":return null;case"Text":return""}}()},b}(),module.exports.WebStore=b}.call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;b=require("memory-record"),a=module.exports.InputTie,new b.Rule("input").schema(function(){return this.scope(function(a){return{checkbox:function(b){return a.where(function(a){return"checkbox"===a.attr.type&&a.sean===b})}}}),this.model=function(b){function d(){a.format(this)}return c(d,b),d}(this.model)})}.call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=require("memory-record"),b=module.exports.WebStore,new a.Rule("store").schema(function(){return this.scope(function(a){}),this.model=function(a){function d(){b.format(this)}return c(d,a),d}(this.model)})}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=[].slice,x=function(a,b){function c(){this.constructor=a}for(var d in b)y.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},y={}.hasOwnProperty;for(b=require("memory-record"),q=require("mithril"),c=require("lodash"),a=module.exports.InputTie,l=function(a,b){return c.assignIn.apply(c,[{}].concat(w.call(a),[b]))},s=function(){var a;return a=1<=arguments.length?w.call(arguments,0):[],a=a.map(function(a){var b;return b=["id","className","selected","disabled","value","label"],a.badge&&b.push("badge"),c.pick(a,b)}),c.assignIn.apply(c,a)},d=function(){var a,b;return a=arguments[0],b=2<=arguments.length?w.call(arguments,1):[],c.assignIn.apply(c,b)},f=function(){var a,b,c,d,e,f,g;return a=arguments[0],c=2<=arguments.length?w.call(arguments,1):[],f=d=this,b=f._value,g=f.tie,e=l(c,{config:this._config,disabled:g.disabled,onblur:function(b){return g.do_blur(a,b)},onfocus:function(b){return g.do_focus(a,b)},onselect:function(b){return g.do_select(a,b)},onchange:function(c){return g.do_change(a,b(c),e)},oninvalid:function(c){return g.do_fail(a,b(c),e)}})},k=function(){var a,b,c,d,e,f,g;return a=arguments[0],c=2<=arguments.length?w.call(arguments,1):[],f=d=this,b=f._value,g=f.tie,e=l(c,{config:this._config,disabled:g.disabled,onblur:function(b){return g.do_blur(a,b)},onfocus:function(b){return g.do_focus(a,b)},onselect:function(b){return g.do_select(a,b)},oninput:function(c){return g.do_change(a,b(c),e)},oninvalid:function(c){return g.do_fail(a,b(c),e)}})},g=function(a){return(a.currentTarget||this).checked},i=function(a){return(a.currentTarget||this).value},h=function(a){var b,c,d,e,f;for(d=(a.currentTarget||this).selectedOptions,e={},b=0,c=d.length;b<c;b++)f=d[b],e[f.value]=!0;return e},v={valid:"valid",valueMissing:"required",typeMismatch:"type",patternMismatch:"pattern",rangeUnderflow:"min",rangeOverflow:"max",stepMismatch:"step",tooLines:"max_line",tooLong:"maxlength",tooShort:"minlength",hasSecret:"not_secret",hasPlayer:"not_player"},e=function(){function e(a,d){var e,f,g;this.tie=a,this.format=d,g=this.format,this._id=g._id,this.options=g.options,this.attr=g.attr,this.name=g.name,this.current=g.current,e=g.info,f=g.option_default,this._config=this.tie._config(this._id),this.__info=e,this.__uri=b.pack[this.type],this.__val=b.unpack[this.type],this.tie.do_draw(this.do_draw.bind(this)),this.option_default=c.assign({},this.option_default,f)}return e.prototype._config=function(){},e.prototype._attr_label=d,e.prototype._value=i,e.prototype._attr=k,e.prototype._debounce=a.prototype._debounce,e.prototype.timeout=100,e.prototype.type="String",e.prototype.option_default={className:"icon-cancel-alt",label:""},e.prototype.info=function(a){this.info_msg=null!=a?a:""},e.prototype.error=function(a){var b;return null==a&&(a=""),null!=(b=this.dom)?b.setCustomValidity(a):void 0},e.prototype.do_context=function(a){},e.prototype.do_dom=function(a){this.dom=a},e.prototype.do_fail=function(a){},e.prototype.do_focus=function(){},e.prototype.do_blur=function(){},e.prototype.do_draw=function(){var a,b,c;return c=this.format,a=c.info,b=c.label,this.__name=this.attr.name||this._id,this.__value=this.tie.params[this._id]},e.prototype.do_change=function(a){var b,c,d,e;if(this.dom&&!this.dom.validity.customError&&this.format.error){d=this.dom.validity;for(b in d)if(e=d[b],e&&(c=this.format.error[v[b]]))return void this.error(c)}},e.prototype.option=function(a){var b;return a?(null!=(b=this.options)?b[a]:void 0)||{}:this.option_default},e.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=s(this.attr,b,d,{className:[d.className,b.className].join(" "),value:this.__uri(a),selected:a===this.__value}),q("option",c,c.label)},e.prototype.datalist=function(a){throw null==a&&(a={}),"not implement"},e.prototype.head=function(a){var b;return null==a&&(a={}),b=this._attr_label(a),q("label",b,this.name)},e.prototype.label=function(a){var b,c,d,e;return null==a&&(a={}),this.label_for&&this.options&&(d=this.options[this.__value])?this.label_for(d):(b=this.__info)?(b.label&&(e=b.label),b.off&&!this.__value&&(e=b.off),b.on&&this.__value&&(e=b.on),b.valid&&this.__value&&(e=b.valid),c=this._attr_label(this._id,a,this.format.label.attr),q("label",c,e)):void 0},e.prototype.field=function(a){var b;return null==a&&(a={}),b=this._attr(this._id,this.attr,a,{className:[this.attr.className,a.className].join(" "),name:this.__name,value:this.__value}),q("input",b)},e}(),r=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.type="Number",b}(e),t=["hidden","tel","password","datetime","date","month","week","time","datetime-local","color"],j=0,o=t.length;j<o;j++)n=t[j],a.type[n]=e;for(u=["number","range"],m=0,p=u.length;m<p;m++)n=u[m],a.type[n]=r;a.type.checkbox=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype._value=g,b.prototype._attr=f,b.prototype.type="Bool",b.prototype.option=function(a){var b,c;return c=a?"on":"off",(null!=(b=this.options)?b[c]:void 0)||{}},b.prototype.field=function(a){var b,c;return null==a&&(a={}),c=this.option(this.__value),b=this._attr(this._id,this.attr,a,{className:[this.attr.className,a.className].join(" "),type:"checkbox",name:this.__name,value:this.__uri(this.__value),checked:this.__value}),q("input",b)},b}(e),a.type.radio=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype._value=i,b.prototype._attr=f,b.prototype.field=function(a){var b,c,d;return null==a&&(a={}),b=function(){var b,e;b=this.options,e=[];for(d in b)c=b[d],c.hidden||e.push(this.item(d,a));return e}.call(this),this.attr.required&&this.format.current||b.unshift(this.item("",a)),b},b.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=this._attr(this._id,this.attr,b,d,{className:[this.attr.className,d.className,b.className].join(" "),type:"radio",name:this.__name,value:this.__uri(a),checked:a===this.__value}),q("input",c,d.label,d.badge?q(".emboss.pull-right",d.badge()):void 0)},b}(e),a.type.select=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype._value=i,b.prototype._attr=f,b.prototype.option_default={className:"",label:"―――"},b.prototype.field=function(a){var b,c,d,e;return null==a&&(a={}),b=function(){var b,c;b=this.options,c=[];for(e in b)d=b[e],d.hidden||c.push(this.item(e,a));return c}.call(this),this.attr.required&&this.format.current||b.unshift(this.item("",a)),c=this._attr(this._id,this.attr,a,{className:[this.attr.className,a.className].join(" "),name:this.__name}),q("select",c,b)},b}(e),a.type.select.multiple=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype._value=h,b.prototype._attr=f,b.prototype.field=function(a){var b,c,d;return null==a&&(a={}),b=this._attr(this._id,this.attr,a,{className:[this.attr.className,a.className].join(" "),name:this.__name}),q("select",b,function(){var a,b;a=this.options,b=[];for(d in a)c=a[d],c.hidden||b.push(this.item(d));return b}.call(this))},b.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=s(this.attr,b,d,{className:[d.className,b.className].join(" "),value:this.__uri(a),selected:this.__value[a]}),q("option",c,c.label)},b}(e)}.call(this),function(){var a,b,c,d,e,f,g,h,i=[].slice,j=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},k={}.hasOwnProperty;h=require("mithril"),b=require("lodash"),a=module.exports.InputTie,c=function(a,c){return a=a.map(function(a){var c;return c=["id","className"],a.title&&c.push("title"),null!=a["data-tooltip"]&&c.push("data-tooltip"),b.pick(a,c)}),b.assignIn.apply(b,i.call(a).concat([c]))},f=function(a,b,c){return c?b.push(c):b.pop(),b},g=function(a,b){return b},e=function(a,b){return a?null:b},d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._attr=function(){var a,b,d,e,f,g,h,j,k,l,m,n,o,p,q;return a=arguments[0],b=3<=arguments.length?i.call(arguments,1,h=arguments.length-1):(h=1,[]),j=arguments[h++],m=d=this,a=m._id,p=m.tie,e=j.className,g=j.disabled,n=j.selected,q=j.value,o=j.target,l=function(){if(!d.timer)return d._debounce()["catch"](function(){return d.timer=null}),q=d._value(n,q,o),p.do_change(a,q,k),d.dom.validity.valid?void 0:p.do_fail(a,q,k)},f="btn",g||p.disabled||(f+=" edge"),n&&(f+=" active"),e&&(f+=" "+e),k=c(b,{config:this._config,className:f,onclick:l,onmouseup:l,ontouchend:l})},b.prototype.do_change=function(a){var c,d,e,f;return e=this.attr,d=e.pattern,f=e.required,this.dom&&(f&&!a&&(c="このフィールドを入力してください。"),d&&a.match(new Regexp(d))&&(c="指定されている形式で入力してください。"),this.error(c)),b.__super__.do_change.apply(this,arguments)},b.prototype.head=function(a){var b,c;return null==a&&(a={}),c=this.format.name,b=this._attr_label(a),h("h6",b,c)},b}(a.type.hidden),a.type.toggle=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._value=g,b.prototype.field=function(a){var b,c,d;return null==a&&(a={}),c=this.__value,d=this.option(c),b=this._attr(this._id,this.attr,a,{className:[this.attr.className,a.className].join(" "),value:c}),h("span",b,d.label,d.badge?h(".emboss.pull-right",d.badge()):void 0)},b}(d),a.type.checkbox_btn=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._value=g,b.prototype.type="Bool",b.prototype.option=function(a){var b,c;return c=a?"on":"off",(null!=(b=this.options)?b[c]:void 0)||{}},b.prototype.field=function(a){var b,c;return null==a&&(a={}),c=this.option(this.__value),b=this._attr(this._id,this.attr,a,{className:[this.attr.className,a.className].join(" "),selected:this.__value,value:this.__value}),h("span",b,this.__name,c.badge?h(".emboss.pull-right",c.badge()):void 0)},b}(d),a.type.icon=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}var c,d,f;return j(b,a),b.prototype._value=e,b.prototype.option_default={className:"",label:"","data-tooltip":"選択しない"},b.prototype.field=function(a){throw null==a&&(a={}),"not implement"},b.prototype["with"]=function(a,b){var c;switch(c=this.__value===a,b){case c:return this._with[a]();case!c:return null;default:return this._with={},this._with[a]=b}},b.prototype.item=function(a,b){var c,d,e;return null==b&&(b={}),d=this.option(a),e=b.tag||"menuicon",c=this._attr(this._id,this.attr,b,d,{className:[this.attr.className,b.className,d.className].join(" "),selected:a===this.__value,value:a}),f[e](a,c,d)},d=function(a,b,c){return h("a.menuicon",b,h("span.icon-"+a),c.badge?h(".emboss.pull-right",c.badge()):void 0)},c=function(a,b,c){return h("section",b,h(".bigicon",h("span.icon-"+a)),c.badge?h(".badge.pull-right",c.badge()):void 0)},f={menuicon:d,bigicon:c},b}(d),a.type.btns=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._value=g,b.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=this._attr(this._id,this.attr,b,d,{className:[this.attr.className,d.className,b.className].join(" "),selected:a===this.__value,value:a}),h("span",c,d.label,d.badge?h(".emboss.pull-right",d.badge()):void 0)},b.prototype.field=function(a){var b,c,d;return null==a&&(a={}),b=function(){var b,e;b=this.options,e=[];for(d in b)c=b[d],c.hidden||e.push(this.item(d,a));return e}.call(this),this.attr.required&&this.format.current||b.unshift(this.item("",a)),b},b}(d),a.type.btns.multiple=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._value=g,b.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=this._attr(this._id,this.attr,b,d,{className:[this.attr.className,d.className,b.className].join(" "),selected:this.__value[a],value:this.__value[a]}),h("span",c,d.label,d.badge?h(".emboss.pull-right",d.badge()):void 0)},b.prototype.field=function(a){var b,c,d,e,f,g,h;null==a&&(a={}),e=this.format,b=e._id,c=e.attr,this.__values=this.tie.params[b],f=this.options,g=[];for(h in f)d=f[h],d.hidden||g.push(this.item(h,a));return g},b}(d),a.type.stack=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._value=f,b.prototype.type="Array",b.prototype.field=function(a){throw null==a&&(a={}),"not implement"},b.prototype.item=function(a,b){var c,d;return null==b&&(b={}),d=this.option(a),c=this._attr(this._id,this.attr,b,d,{className:[this.attr.className,d.className,b.className].join(" "),target:a,value:this.__value}),h("span",c,d.label,d.badge?h(".emboss.pull-right",d.badge()):void 0)},b.prototype.back=function(a){return null==a&&(a={}),this.item("",a)},b}(d)}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=[].slice,o=function(a,b){function c(){this.constructor=a}for(var d in b)p.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},p={}.hasOwnProperty;b=require("memory-record"),h=require("mithril"),d=require("lodash"),j=module.exports,a=j.InputTie,c=j.Tie,g=function(a,b){var c,d;return a.offset=null,a.offsets=[],null==b||null==a?a.offsets:(null!=b.touches?(d=a.getBoundingClientRect(),a.offsets=function(){var a,e,f,g;for(f=b.touches,g=[],a=0,e=f.length;a<e;a++)c=f[a],g.push(k(k,d));return g}(),1===b.touches.length&&(a.offset=a.offsets[0])):(a.offset=i(b),null!=a.offset&&(a.offsets=[a.offset])),a.history.push(a.offsets))},i=function(a){var b,c;if(b=a.offsetX||a.layerX,c=a.offsetY||a.layerY,null!=b&&null!=c)return b*=2,c*=2,[b,c]},l=function(a,b){var c,d,e,f,g,h;return d=a.pageX,e=a.pageY,c=b.left,f=b.top,g=2*(d-c-window.scrollX),h=2*(e-f-window.scrollY),[g,h]},m=function(a,b){var c,d,e,f,g,h;return d=a.pageX,e=a.pageY,c=b.left,f=b.top,g=2*(d-c),h=2*(e-f-window.scrollY),[g,h]},k=m,e=function(a,b){return d.assignIn.apply(d,[{}].concat(n.call(a),[b]))},f=function(){var a,b,d,e,f;return f=c.browser,d=f.ios,b=f.ff,e=f.old,a=f.chrome,k=d||b||e&&a?l:m},a.type.canvas=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return o(b,a),b.prototype.type="Array",b.prototype.do_draw=function(){},b.prototype.do_dom=function(a){this.dom=a},b.prototype.do_context=function(a){return this.ctx=a,this.do_blur()},b.prototype.do_focus=function(a){return this.ctx.is_tap=!0},b.prototype.do_blur=function(a){return this.ctx.is_tap=!1,this.ctx.history=[]},b.prototype.do_fail=function(a){},b.prototype.do_change=function(a){},b.prototype._value=function(a){return a.offsets},b.prototype._attr=function(){var a,b,c,d,f,h,i,j,k,l;return a=arguments[0],c=2<=arguments.length?n.call(arguments,1):[],b=this._value,l=this.tie,f=this.ctx,k=function(b){return l.do_focus(a,b),j(b)},h=function(b){return j(b),l.do_blur(a,b)},j=function(c){return g(f,c),l.do_change(a,b(f),i)},d=function(c){return g(f,c),l.do_fail(a,b(f),i),l.do_blur(a,c)},i=e(c,{config:this._config,ontouchend:h,ontouchmove:j,ontouchstart:k,ontouchcancel:d,onmouseup:h,onmousemove:j,onmousedown:k,onmouseout:h,onmouseover:j})},b.prototype.field=function(a){var b,c,d,e;return null==a&&(a={}),d=a.size||this.attr.size,e=d[0],b=d[1],c=this._attr(this._id,this.attr,a,{className:[this.attr.className,a.className].join(" "),width:e,height:b,style:"width: "+e/2+"px; height: "+b/2+"px;"}),h("canvas",c)},b}(a.type.hidden)}.call(this),function(){var a,b,c,d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;b=require("memory-record"),e=require("mithril"),d=require("lodash"),f=module.exports,a=f.InputTie,c=f.Tie,a.type.timeline=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.type="Array",b.prototype.do_draw=function(){},b.prototype.do_dom=function(a,b){this.dom=a},b.prototype.do_context=function(a){return this.ctx=a,this.do_blur()},b.prototype.do_focus=function(a){return this.ctx.is_tap=!0},b.prototype.do_blur=function(a){return this.ctx.is_tap=!1,this.ctx.history=[]},b.prototype.do_fail=function(a){},b.prototype.do_change=function(a){},b.prototype._value=function(a){return a.offsets},b}(a.type.canvas)}.call(this),function(){var a,b,c,d,e,f,g,h,i,j=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},k={}.hasOwnProperty;for(f=require("mithril"),b=require("lodash"),a=module.exports.InputTie,i=function(a){var b;return b=20,50<a&&(b+=(a-50)/14),Math.floor(b)},h=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return j(c,b),c.prototype.do_draw=function(){var a,b,c,d,e;return e=this.attr.unit,this.__name=this.attr.name||this._id,this.__value=this.tie.params[this._id],c=this.__value.length,d=this.__value.sjis_length,a=this.__value.split("\n").length,"point"===e&&(b=i(d)),this.calc={point:b,line:a,sjis:d,size:c}},c.prototype.do_change=function(b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;return m=this.attr,k=m.not_secret,j=m.not_player,r=m.unit,g=m.max_sjis,f=m.max_line,i=m.minlength,h=m.maxlength,l=m.pattern,p=m.required,n=this.calc,e=n.line,q=n.sjis,this.dom&&(k&&b.match(/>>[\=\*\!]\d+/g)&&(d="あぶない！秘密会話へのアンカーがあります！"),j&&b.match(/\/\*|\*\//g)&&(d="/*中の人の発言があります。*/"),f&&f<e&&(d="このテキストを "+f+" 行以下にしてください。"),g&&g<q&&(d="このテキストを "+g+" 文字以下にしてください。"),i&&0<(o=b.length)&&o<i&&(a.skip_minlength||(d="このテキストは "+i+" 文字以上で指定してください（現在は "+b.length+" 文字です）。")),this.error(d)),c.__super__.do_change.apply(this,arguments)},c.prototype.foot=function(a){var b,c,d,e;return null==a&&(a={}),b=this._attr_label(this._id,this.attr,a),e=this.calc.size,b.maxlength&&(d=b.maxlength),b.max_sjis&&(e=this.calc.sjis,d=b.max_sjis),c=this.calc.point?f("span.emboss",this.calc.point+"pt "):"",this.dom&&!this.dom.validationMessage||(c=f("span.WSAY.emboss","⊘")),[c," "+e,null!=d?f("sub","/"+d):void 0,f("sub","字")," "+this.calc.line,null!=b.max_line?f("sub","/"+b.max_line):void 0,f("sub","行")]},c}(a.type.hidden),a.type.textarea=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype.field=function(a){var b;return null==a&&(a={}),b=this._attr(this._id,this.attr,a,{className:[this.attr.className,a.className].join(" "),name:this.__name}),f("textarea",b,this.__value)},b}(h),g=["text","search","url","email"],c=0,e=g.length;c<e;c++)d=g[c],a.type[d]=h}.call(this);
//# sourceMappingURL=mithril-tie.min.js.map